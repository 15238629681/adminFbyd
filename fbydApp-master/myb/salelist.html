<!DOCTYPE html>
<html>

<head>
<meta charset="utf-8">
<title>Hello MUI</title>
<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">

<link rel="stylesheet" href="../css/mui.min.css">
<style>
.mui-bar{background: #fff !important;}
.mui-bar-nav~.mui-content .mui-slider.mui-fullscreen {
	top: 60px;
	height: auto;
}
.mui-pull-top-tips {
	position: absolute;
	top: -20px;
	left: 50%;
	margin-left: -25px;
	width: 40px;
	height: 40px;
	border-radius: 100%;
	z-index: 1;
}
.mui-bar~.mui-pull-top-tips {
	top: 24px;
}
.mui-pull-top-wrapper {
	width: 42px;
	height: 42px;
	display: block;
	text-align: center;
	background-color: #efeff4;
	border: 1px solid #ddd;
	border-radius: 25px;
	background-clip: padding-box;
	overflow: hidden;
}
.mui-pull-top-tips.mui-transitioning {
	-webkit-transition-duration: 200ms;
	transition-duration: 200ms;
}
.mui-pull-top-wrapper .mui-icon,
.mui-pull-top-wrapper .mui-spinner {
	margin-top: 7px;
}
.mui-pull-bottom-tips {
	text-align: center;
	background-color: none;
	font-size: 14px;
	line-height: 40px;
	color: #777;
	position: absolute;
	bottom: -30px;
	width: 100%;
}
.mui-pull-top-canvas canvas {
	width: 40px;
}
.mui-slider-indicator.mui-segmented-control {
	background-color: #efeff4;
}

html,body{width: 100%;}
.clean:before, .clean:after{content:"";display:table;}
.clean:after{clear:both;}
.clean{zoom:1;}
.mui-table-view:before{background: none;}
.mui-table-view:after{background: none;}
.mui-bar{height: 60px;padding-top: 20px;background: #fff;}
.mui-bar-nav~ .mui-content{padding-top: 60px;width: 100%;height: 100%;}
.mui-content .mui-slider-group .mui-slider-item .mui-scroll-wrapper{padding-bottom: 40px;}
a{color: #999;}
b{font-weight: normal;}
.mui-bar .mui-title span{display: inline-block;padding:0 6px;color: #FBDD00;height: 32px;line-height: 32px;
border:1px #FBDD00 solid;}
.mui-bar .mui-title .active{background: #FBDD00;color: #fff;}

#sliderSegmentedControl{background: #fff;}
.mui-control-item{background: #fff;position: relative;}
.mui-slider{height: 100%;}
.mui-slider-group{height: 100%;}
.mui-slider-item{height: 100%;}
.mui-slider .mui-segmented-control.mui-segmented-control-inverted~.mui-slider-group .mui-slider-item{border: none;}
.mui-segmented-control.mui-segmented-control-inverted .mui-control-item.mui-active{color:#FBBD00;}

#sliderProgressBar{background-color:#FBBD00;}
.mui-slider-progress-bar{height: 1px;}
.mui-table-view li a{font-size: 16px;}
.mui-table-view li span{font-size: 14px;color: #9FA0A0;float: right;margin-right: 20px;}

.mui-segmented-control.mui-scroll-wrapper .mui-scroll{width: 100%;}
.mui-segmented-control.mui-scroll-wrapper .mui-control-item{padding: 0;width: 25%;text-align: center;}
.mui-fullscreen .mui-segmented-control~.mui-slider-group{top: 39px;height: 100%;}

.item{margin-bottom: 10px;background: #fff;padding-top: 10px;}
.item .ordernum > div{float: left;}
.item .ordernum .ordertime{float: right;margin-right: 8px;}
.item .ordernum .order{padding-left: 10px;width: 55%;}
.item .ordernum .ordertime > div{font-size: 12px;text-align: right;color: #969696;}
.goodsBlock{padding: 6px 10px;border-bottom: 1px solid #eee;position:relative;}
.left{width: 70px;height: 70px;float: left;margin-right: 8px;position: relative;}
.left img{width:100%;}

.middle{float: left;}
.middle p{font-size: 14px;}
.middle .goodsName{color: #666;margin-bottom: 8px;margin-top:4px;font-size: 12px;width: 12rem;min-height: 1rem;max-height: 2rem;
overflow: hidden;line-height: 16px;}
.middle .goodmoney{font-size: 12px;}

.right{position: absolute;right: 6px;margin-top: 18px;}
.right > div{text-align: center;}
.profit1{color: #14D100;}
.profit2{color: #FBBD00;}
.profit3{color: #969696;}

.mui-slider-group{padding-bottom: 40px;}
.mui-scroll{min-height: 80%;}
@media screen and (max-width: 340px)  {
	.middle .goodsName{width: 10rem;}
}
@media screen and (min-width: 400px)  {
	.middle .goodsName{width: 14rem;}
}
</style>
</head>

<body>
<header class="mui-bar mui-bar-nav">
    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left mui-icon-arrowleft"></a>
    <h1 class="mui-title"><span class="active" data-type="0">销售明细</span><span data-type="1">分销明细</span></h1>
</header>
<div class="item" style="display: none;">
	<div class="ordernum clean">
		<div class="order">订单编号：<b>12345678912345</b></div>
		<div class="ordertime">
			<div>2017-07-29 16:19:20 下单</div>
			<div>2017-08-05 21:13:55 确认</div>
		</div>
	</div>
	<div class="goodsBlock clean"> 
		<div class="left">
			<img class="goodsmig" src="../images/goods1.png" alt="">
		</div>
		<div class="middle">
			<p class="goodsName">销售量销售量销售量销售量销</p>
			<div class="goodmoney">
				<div>付款金额：￥<b>15.25</b></div>
			</div>
		</div>
		<div class="right">
			<div>已失效</div>
			<div class="profit3">￥<b>23.65</b>元</div>
		</div>
	</div>
</div>
<div class="mui-content">
	<div id="slider" class="mui-slider mui-fullscreen">
		<div id="sliderSegmentedControl" class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
			<div class="mui-scroll">
				<a class="mui-control-item mui-active" href="#item1mobile">全部</a><a class="mui-control-item" href="#item2mobile">已付款</a><a class="mui-control-item" href="#item3mobile">已失效</a><a class="mui-control-item" href="#item4mobile">已确认</a>
			</div>
		</div>
		<div id="sliderProgressBar" class="mui-slider-progress-bar mui-col-xs-3"></div>
		<div class="mui-slider-group">
			<div id="item1mobile" class="mui-slider-item mui-control-content mui-active">
				<div id="scroll1" class="mui-scroll-wrapper">
					<div class="mui-scroll list-wrap">
					</div>
				</div>
			</div>
			<div id="item2mobile" class="mui-slider-item mui-control-content">
				<div class="mui-scroll-wrapper">
					<div class="mui-scroll list-wrap">
					</div>
				</div>
			</div>
			<div id="item3mobile" class="mui-slider-item mui-control-content">
				<div class="mui-scroll-wrapper">
					<div class="mui-scroll list-wrap">
					</div>
				</div>
			</div>
			<div id="item4mobile" class="mui-slider-item mui-control-content">
				<div class="mui-scroll-wrapper">
					<div class="mui-scroll list-wrap">
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<script src="../js/mui.min.js"></script>
<script src="../js/mui.pullToRefresh.js"></script>
<script src="../js/mui.pullToRefresh.material.js"></script>
<script>
(function($,doc) {
		
		//阻尼系数
		var deceleration = mui.os.ios?0.003:0.0009;
		$('.mui-scroll-wrapper').scroll({
			bounce: false,
			//indicators: true, //是否显示滚动条
			deceleration:deceleration
		});
		$.plusReady(function(){
			
			plus.webview.currentWebview().setStyle({
				scrollIndicator:"none"
			});
				
			//重新定义后退函数(监听安卓后退键事件)
			$.back = function(event) {
				plus.webview.close(plus.webview.currentWebview());
				return false;
			};
		})
		
		$.ready(function() {
			var user_token = JSON.parse(localStorage.getItem("userinfo")).token;
			var time = parseInt(new Date().getTime() / 1000);
			var user_id = JSON.parse(localStorage.getItem("userinfo")).userinfo.uid;
    		var firstItem = doc.getElementsByClassName("item")[0];
    		function getItem(listInfo){
    			var item = firstItem.cloneNode(true);
    			item.getElementsByClassName("order")[0].getElementsByTagName("b")[0].innerHTML = listInfo.ddbh;
    			var T1 =  new Date(listInfo.xdsj*1000);
    			var T2 =  new Date(listInfo.jssj*1000);
				var time1 = T1.getFullYear() + '-' + (T1.getMonth()+1) + '-' + T1.getDate()+" "+T1.getHours() + ':' + T1.getMinutes() + ':' + T1.getSeconds();
				var time2 = T2.getFullYear() + '-' + (T1.getMonth()+1) + '-' + T2.getDate()+" "+T2.getHours() + ':' + T2.getMinutes() + ':' + T2.getSeconds();
				item.getElementsByClassName("ordertime")[0].getElementsByTagName("div")[0].innerHTML = time1+"下单";
				item.getElementsByClassName("ordertime")[0].getElementsByTagName("div")[1].innerHTML = time2+"结算";
    			item.getElementsByClassName("goodsName")[0].innerHTML = listInfo.spxx;
    			item.getElementsByClassName("goodmoney")[0].getElementsByTagName("b")[0].innerHTML = listInfo.fkje;
    			item.getElementsByClassName("right")[0].getElementsByTagName("b")[0].innerHTML = listInfo.xgyg.toFixed(2);
    			item.getElementsByClassName("goodsmig")[0].src = listInfo.pict_url+"_160x160.jpg";
    			item.getElementsByClassName("right")[0].getElementsByTagName("div")[0].innerHTML = listInfo.ddzt;
    			if(listInfo.ddzt=="已失效"){
    				item.getElementsByClassName("right")[0].getElementsByTagName("div")[1].className = "profit3";
    				item.getElementsByClassName("ordertime")[0].getElementsByTagName("div")[1].style.display = "none";
    			}else if(listInfo.ddzt=="确认预估利润"||listInfo.ddzt=="确认预估奖励"){
    				item.getElementsByClassName("right")[0].getElementsByTagName("div")[1].className = "profit1";
    			}else{
    				item.getElementsByClassName("right")[0].getElementsByTagName("div")[1].className = "profit2";
    				item.getElementsByClassName("ordertime")[0].getElementsByTagName("div")[1].style.display = "none";
    			}
    			item.style.display = "block";
    			return item;
    		};
    		var slider_index = 1;
    		var page_1 = 1;
    		var page_2 = 1;
    		var page_3= 1;
    		var page_4 = 1;
    		var ordertype = 0;
    		pullUp("all",0,0,ordertype);
    		pullUp("pay","1",0,ordertype);
    		pullUp("cancel","2",0,ordertype);
    		pullUp("confirm","3",0,ordertype);
    		
    		$(".mui-title").on("tap","span",function(){
    			var type = parseInt(this.getAttribute("data-type"));
    			if(type != ordertype){
    				ordertype = type;
    				this.parentNode.getElementsByClassName("active")[0].className = "";
    				this.className = "active";
    				for(var i=0;i<4;i++){
    					doc.getElementsByClassName("list-wrap")[i].innerHTML = "";
    				}
    				pullUp("all",0,0,ordertype);
    				pullUp("pay","1",0,ordertype);
    				pullUp("cancel","2",0,ordertype);
    				pullUp("confirm","3",0,ordertype);
    			}
    		})
    		
    		function pullUp(type,index,page,ordertype){
    			$.ajax({
    				type:"post",
    				url:"https://app.fanbaoyundian.com/appapi/orders.app.php",
    				data:{
    					uid:user_id,
    					token:user_token,
    					timestamp:time,
    					count:10,
    					start:page,
    					ordertype:ordertype,
    					orderstate:type
    				},
    				success:function(data){
    					//alert(JSON.stringify(data))
    					if(data.state==0){
    						plus.nativeUI.toast(data.message);
    					}else{
    						var list_wrap = doc.getElementsByClassName("list-wrap")[index];
    						for(var i=0;i<data.orderlist.length;i++){
    							var itemlist = getItem(data.orderlist[i]);
    							list_wrap.appendChild(itemlist);
    						}
    					}
    				},
    				error:function(xhr,type,errorThrown){
    					if(type=="timeout"){
    						plus.nativeUI.toast("请求超时，请检查网络");
    					}
    				}
    			});
    	
    		};
    		function pullDown(type,index,page,ordertype){
    			$.ajax({
    				type:"post",
    				url:"https://app.fanbaoyundian.com/appapi/orders.app.php",
    				data:{
    					uid:user_id,
    					token:user_token,
    					timestamp:time,
    					count:10,
    					start:page,
    					ordertype:ordertype,
    					orderstate:type
    				},
    				success:function(data){
    					//alert(JSON.stringify(data))
    					if(data.state==0){
    						plus.nativeUI.toast(data.message);
    					}else{
    						var list_wrap = doc.getElementsByClassName("list-wrap")[index];
    						if(list_wrap.getElementsByClassName("item").length){
    							var oldId = list_wrap.getElementsByClassName("order")[0].getElementsByTagName("b")[0].innerHTML;
    							if(oldId == data.orderlist[0].ddbh){
    								$.toast("已经是最新数据啦");
    							}else{
    								list_wrap.innerHTML = "";
    								for(var i=0;i<data.orderlist.length;i++){
    									var itemlist = getItem(data.orderlist[i]);
    									list_wrap.appendChild(itemlist);
    								}
    							}
    						}else{
    							$.toast("暂无数据");
    						}
    					}
    				},
    				error:function(xhr,type,errorThrown){
    					if(type=="timeout"){
    						plus.nativeUI.toast("请求超时，请检查网络");
    					}
    				}
    			});
    	
    		};
    		
			document.getElementById('slider').addEventListener('slide', function(e) {
				if (e.detail.slideNumber === 0) {
					slider_index=1;
				} else if (e.detail.slideNumber === 1) {
					slider_index=2;
				} else if (e.detail.slideNumber === 2) {
					slider_index=3;
				} else if (e.detail.slideNumber === 3) {
					slider_index=4;
				}
			});
    		
			//循环初始化所有下拉刷新，上拉加载。
			$.each(document.querySelectorAll('.mui-slider-group .mui-scroll'), function(index, pullRefreshEl) {
				$(pullRefreshEl).pullToRefresh({
					down: {
						callback: function() {
							var self = this;
							setTimeout(function() {
								//var ul = self.element.querySelector('.mui-table-view');
								//ul.insertBefore(createFragment(ul, index, 10, true), ul.firstChild);
								if(slider_index==1){
									pullDown("all",0,0,ordertype);
								}else if(slider_index==2){
									pullDown("pay",1,0,ordertype);
								}else if(slider_index==3){
									pullDown("cancel",2,0,ordertype);
								}else{
									pullDown("confirm",3,0,ordertype);
								}
								self.endPullDownToRefresh();
							}, 1000);
						}
					},
					up: {
						callback: function() {
							var self = this;
							//alert(JSON.stringify(this))
							setTimeout(function() {
								//var ul = self.element.querySelector('.mui-table-view');
								//ul.appendChild(createFragment(ul, index, 5));
								if(slider_index==1){
									pullUp("all",0,page_1,ordertype);
									page_1++;
								}else if(slider_index==2){
									pullUp("pay",0,page_2,ordertype);
									page_2++;
								}else if(slider_index==3){
									pullUp("cancel",0,page_3,ordertype);
									page_3++;
								}else{
									pullUp("confirm",0,page_4,ordertype);
									page_4++;
								}
								self.endPullUpToRefresh();
							}, 1000);
						}
					}
				});
			});
//			var createFragment = function(ul, index, count, reverse) {
//				var length = ul.querySelectorAll('li').length;
//				var fragment = document.createDocumentFragment();
//				var li;
//				for (var i = 0; i < count; i++) {
//					li = document.createElement('li');
//					li.className = 'mui-table-view-cell';
//					li.innerHTML = '第' + (index + 1) + '个选项卡子项-' + (length + (reverse ? (count - i) : (i + 1)));
//					fragment.appendChild(li);
//				}
//				return fragment;
//			};
	});
})(mui,document);
</script>
</body>

</html>