<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>TA的主页</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<script type="text/javascript" src="../js/rem.js"></script>
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="../css/cloudstore/searchblock.css" />
		<link rel="stylesheet" href="../css/cloudstore/cloudstorecategory.css" />
		<style>
			html,
			body {
				background-color: #fff;
				width: 100%;
			}
			
			.mui-bar {
				height: 60px;
				padding-top: 20px;
				background: #fff;
				border-bottom: 1px solid rgb(239, 239, 239);
			}
			
			a {
				color: #999;
			}
			
			b {
				font-weight: normal;
			}
			
			.mui-segmented-control.mui-scroll-wrapper .mui-scroll {
				min-width: 100%;
			}
			
			.mui-segmented-control.mui-scroll-wrapper .mui-control-item {
				padding: 0;
				color: #727171;
				line-height: 20px;
				padding: 10px 12px;
			}
			
			.mui-segmented-control.mui-segmented-control-inverted .mui-control-item.mui-active {
				color: #FBBD00;
			}
			
			.mui-segmented-control.mui-segmented-control-inverted {
				border-bottom: 1px solid #eee;
			}
			
			.mui-bar-nav~.mui-content .mui-slider.mui-fullscreen {
				top: 60px;
			}
			
			.mui-slider-indicator.mui-segmented-control {
				background-color: #fff;
			}
			
			.mui-segmented-control.mui-scroll-wrapper {
				height: 40px;
			}
			
			.mui-pull-top-tips {
				position: absolute;
				top: -20px;
				left: 50%;
				margin-left: -25px;
				width: 40px;
				height: 40px;
				border-radius: 100%;
				z-index: 1;
			}
			
			.mui-bar~.mui-pull-top-tips {
				top: 24px;
			}
			
			.mui-pull-top-wrapper {
				width: 42px;
				height: 42px;
				display: block;
				text-align: center;
				background-color: #efeff4;
				border: 1px solid #ddd;
				border-radius: 25px;
				background-clip: padding-box;
				box-shadow: 0 4px 10px #bbb;
				overflow: hidden;
			}
			
			.mui-pull-top-tips.mui-transitioning {
				-webkit-transition-duration: 200ms;
				transition-duration: 200ms;
			}
			
			.mui-pull-top-tips .mui-pull-loading {
				margin: 0;
			}
			
			.mui-pull-top-wrapper .mui-icon,
			.mui-pull-top-wrapper .mui-spinner {
				margin-top: 7px;
			}
			
			.mui-pull-bottom-tips {
				text-align: center;
				background-color: #efeff4;
				font-size: 15px;
				line-height: 40px;
				color: #777;
			}
			
			.mui-pull-top-canvas {
				overflow: hidden;
				background-color: #fafafa;
				border-radius: 40px;
				box-shadow: 0 4px 10px #bbb;
				width: 40px;
				height: 40px;
				margin: 0 auto;
			}
			
			.mui-pull-top-canvas canvas {
				width: 40px;
			}
			
			.banner {
				margin-top: 40px;
				border-bottom: 1px solid #333;
			}
		</style>
		<style>
			.kOrderBlock {
				position: fixed;
				top: 100px;
				display: none;
			}
			/*遮罩层*/
			
			.maskDiv {
				position: fixed;
				top: 0;
				right: 0;
				bottom: 0;
				left: 0;
				display: none;
				z-index: 9999;
				background-color: rgba(0, 0, 0, 0.1);
			}
		</style>
	</head>

	<body>
		<div class="maskDiv"></div>
		<header class="mui-bar mui-bar-nav header">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left mui-icon-arrowleft"></a>
			<span class="mui-icon mui-icon-search"></span>
			<input readonly="readonly" id="searchInput" placeholder="搜索商品" />
			<span id="message"></span>
		</header>
		<div class="mui-content">
			<div id="slider" class="mui-slider mui-fullscreen">
				<div id="sliderSegmentedControl" class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
					<div class="mui-scroll">
						<a class="mui-control-item" href="#" data-wid="ladies" data-fqcat="1">女装</a>
						<a class="mui-control-item" href="#" data-wid="men" data-fqcat="2">男装</a>
						<a class="mui-control-item" href="#" data-wid="underwear" data-fqcat="3">内衣</a>
						<a class="mui-control-item" href="#" data-wid="baby" data-fqcat="4">母婴</a>
						<a class="mui-control-item" href="#" data-wid="bag" data-fqcat="5">包包</a>
						<a class="mui-control-item" href="#" data-wid="house" data-fqcat="7">居家</a>
						<a class="mui-control-item" href="#" data-wid="shoes" data-fqcat="8">鞋品</a>
						<a class="mui-control-item" href="#" data-wid="food" data-fqcat="9">美食</a>
						<a class="mui-control-item" href="#" data-wid="ras" data-fqcat="10">文体</a>
						<a class="mui-control-item" href="#" data-wid="electric" data-fqcat="11">家电</a>
						<a class="mui-control-item" href="#" data-wid="other" data-fqcat="12">其他</a>
						<a class="mui-control-item" href="#" data-wid="accessories" data-fqcat="13">配饰</a>
						<a class="mui-control-item" href="#" data-wid="digital" data-fqcat="14">数码</a>
					</div>
				</div>
			</div>   

		</div>
		<script src="../js/mui.min.js"></script>
		<script src="../js/webviewGroup.js" type="text/javascript" charset="utf-8"></script>
		<script>
			//筛选
					var main, menu10, mask = mui.createMask(_closeMenu);
					var showMenu = false,
						mode = 'menu-move';

					//			判断处理左划  菜单是否显示
					//			页面返回之前处理的函数
					function back() {
						if(showMenu) {
							closeMenu();
							return false;
						} else {
							//					菜单隐藏的时候,执行返回的时,先close菜单页面,然后执行mui.back逻辑关闭主窗口
						}
					}

					/*
					 * 显示菜单菜单
					 */
					function openMenu() {
						if(!showMenu) {
							//解决android 4.4以下版本webview移动时，导致fixed定位元素错乱的bug;
							if(mui.os.android && parseFloat(mui.os.version) < 4.4) {
								document.querySelector("header.mui-bar").style.position = "static";
								//同时需要修改以下.mui-contnt的padding-top，否则会多出空白；
								document.querySelector(".mui-bar-nav~.mui-content").style.paddingTop = "0px";
							}

							//侧滑菜单处于隐藏状态，则立即显示出来；
							//显示完毕后，根据不同动画效果移动窗体；
							menu10.show('none', 0, function() {
								switch(mode) {
									case 'menu-move':
										menu10.setStyle({
											left: '30%',
											transition: {
												duration: 150
											}
										});
										break;
								}
							});
							//显示主窗体遮罩
							mask.show();
							showMenu = true;
						}
					};

					//			关闭侧滑菜单
					function closeMenu() {
						_closeMenu();
						//	menu10=null;
						//关闭遮罩层
						mask.close();
						//	alert("1")
					}

					/**
					 * 关闭侧滑菜单(业务部分)
					 */
					function _closeMenu() {
						showMenu = true;
						if(showMenu) {
							//解决android 4.4以下版本webview移动时，导致fixed定位元素错乱的bug;
							if(mui.os.android && parseFloat(mui.os.version) < 4.4) {
								//						document.querySelector("header.mui-bar").style.position = "fixed";
								//同时需要修改以下.mui-contnt的padding-top，否则会多出空白；
								document.querySelector(".mui-bar-nav~.mui-content").style.paddingTop = "44px";
							}

							switch(mode) {
								case 'main-move':
									//主窗体开始侧滑；
									main.setStyle({
										left: '0',
										transition: {
											duration: 150
										}
									});
									break;
								case 'menu-move':
									//主窗体开始侧滑；
									menu10.setStyle({
										left: '100%',
										transition: {
											duration: 150
										}
									});
									break;
								case 'all-move':
									//主窗体开始侧滑；
									main.setStyle({
										left: '0',
										transition: {
											duration: 150
										}
									});
									//menu页面同时移动
									menu10.setStyle({
										left: '100%',
										transition: {
											duration: 150
										}
									});

									break;
							}
							//等窗体动画结束后，隐藏菜单webview，节省资源；
							setTimeout(function() {
								plus.webview.close(plus.webview.getWebviewById("menu10"));
							}, 300);
							showMenu = false;
						}
					}

					//在android4.4中的swipe事件，需要preventDefault一下，否则触发不正常
					//故，在dragleft，dragright中preventDefault
					window.addEventListener('dragright', function(e) {
						e.detail.gesture.preventDefault();
					});
					window.addEventListener('dragleft', function(e) {
						e.detail.gesture.preventDefault();
					});
					//主界面向左滑动，若菜单未显示，则显示菜单；否则不做任何操作；
					//window.addEventListener("swipeleft", openMenu);
					//主界面向右滑动，若菜单已显示，则关闭菜单；否则，不做任何操作；
					//window.addEventListener("swiperight", closeMenu);
					//menu页面向右滑动，关闭菜单；
					window.addEventListener("menu10:swiperight", closeMenu);
					//重写mui.menu方法，Android版本menu按键按下可自动打开、关闭侧滑菜单；
					mui.menu10 = function() {
						if(showMenu) {
							closeMenu();
						} else {
							openMenu();
						}
					}

			
			
			
			mui.plusReady(function() {
				var zhpxFlag = false;
				localStorage.removeItem("cloudstorecategoryOrder");
				localStorage.removeItem("cloudstorecategorySxCondition");
				main = plus.webview.currentWebview();
				setTimeout(function() {
					//进行预加载
					menu10 = mui.preload({
						id: 'cloudstoredragleftmenu2.html',
						url: 'cloudstorecategorydragleftmenu2.html',
						styles: {
							left: "30%",
							width: '70%',
							zindex: 9999
						}
					});
				}, 300);
				
				
			});

			window.addEventListener("openMenu", function() {
					setTimeout(function() {
						openMenu();
		
					}, 500);
			});
			
			(function($, doc) {

				window.addEventListener("publicOrderFn", function(event) {

					var show = event.detail.show;
					if(show) {
						document.getElementsByClassName("kOrderBlock")[0].setAttribute("display", "block")
						document.getElementById("slider").style.display = "none";
						//						alert("show");
						alert(document.getElementsByClassName("kOrderBlock")[0].getAttribute("display"));
						//						var fqcat = localStorage.getItem("nowFqcat");
					} else {
						//						alert(document.getElementsByClassName("kOrderBlock")[0].getAttribute("display"))
						//						alert("false")
						document.getElementsByClassName("kOrderBlock")[0].style.display = "none";
						document.getElementById("slider").style.display = "block";
						//						alert("---"+document.getElementsByClassName("kOrderBlock")[0].getAttribute("display"))
					}
				});

				window.addEventListener("changeBackground", function(event) {
					//					document.getElementsByClassName("mui-scroll")[0].style.cssText="background-color: rgba(0, 0, 0, 0.1);";
					//					document.getElementById("slider").style.cssText="background-color: rgba(0, 0, 0, 0.1);";
					document.getElementsByClassName("maskDiv")[0].style.cssText = "display:block;";
				});
				window.addEventListener("changeBackground2", function(event) {
					//					document.getElementsByClassName("mui-scroll")[0].style.cssText="background-color:#fff;";
					//					document.getElementById("slider").style.cssText="background-color:#fff;";
					document.getElementsByClassName("maskDiv")[0].style.cssText = "display:none;";
					//					alert("changeBackground2")

				});
				//				document.getElementsByClassName("mui-scroll")[0].style.cssText="background-color:#fff;";
				//				document.getElementById("slider").style.cssText="background-color:#fff;";

				$.init();

				

				$.plusReady(function() {
					var ws = plus.webview.currentWebview();
					var group = new webviewGroup(ws.id, {
						items: [{
								id: "ladies",
								url: "ladies.html",
								styles: {
									top: "100px",
									bottom: "0"
								},
								extras: {
									fqcat: "1"
								},
								waiting: {
									autoShow: false
								}
							}, {
								id: "men",
								url: "men.html",
								styles: {
									top: "100px",
									bottom: "0"
								},
								extras: {
									fqcat: "2"
								},
								waiting: {
									autoShow: false
								}
							}, {
								id: "underwear",
								url: "underwear.html",
								styles: {
									top: "100px",
									bottom: "0"
								},
								extras: {
									fqcat: "3"
								}
							}, {
								id: "baby",
								url: "baby.html",
								styles: {
									top: "100px",
									bottom: "0"
								},
								extras: {
									fqcat: "4"
								}
							}, {
								id: "bag",
								url: "bag.html",
								styles: {
									top: "100px",
									bottom: "0"
								},
								extras: {
									fqcat: "5"
								}
							}, {
								id: "house",
								url: "house.html",
								styles: {
									top: "100px",
									bottom: "0"
								},
								extras: {
									fqcat: "7"
								}
							}, {
								id: "shoes",
								url: "shoes.html",
								styles: {
									top: "100px",
									bottom: "0"
								},
								extras: {
									fqcat: "8"
								}
							},

							{
								id: "food",
								url: "food.html",
								styles: {
									top: "100px",
									bottom: "0"
								},
								extras: {
									fqcat: "9"
								}
							}, {
								id: "ras",
								url: "ras.html",
								styles: {
									top: "100px",
									bottom: "0"
								},
								extras: {
									fqcat: "10"
								}
							}, {
								id: "electric",
								url: "electric.html",
								styles: {
									top: "100px",
									bottom: "0"
								},
								extras: {
									fqcat: "11"
								}
							}, {
								id: "other",
								url: "other.html",
								styles: {
									top: "100px",
									bottom: "0"
								},
								extras: {
									fqcat: "12"
								}
							}, {
								id: "accessories",
								url: "accessories.html",
								styles: {
									top: "100px",
									bottom: "0"
								},
								extras: {
									fqcat: "13"
								}
							}, {
								id: "digital",
								url: "digital.html",
								styles: {
									top: "100px",
									bottom: "0"
								},
								extras: {
									fqcat: "14"
								}
							}
						],
						onChange: function(obj) {
							plus.nativeUI.closeWaiting();
							var c = document.querySelector(".mui-control-item.mui-active");
							var nowFqcat;
							if(obj.index <= 4) {
								nowFqcat = obj.index + 1;
							} else {
								nowFqcat = obj.index + 2;
							}
							localStorage.setItem("nowFqcat", nowFqcat);
							//							alert(obj.index)
							if(c) {
								c.classList.remove("mui-active");
							}
							document.querySelector(".mui-scroll .mui-control-item:nth-child(" + (parseInt(obj.index) + 1) + ")").classList.add("mui-active");
						}
					});

					//					var self = plus.webview.currentWebview();
					var fqcat = parseInt(ws.dataFqcat);
					localStorage.setItem("nowFqcat", fqcat);
					if(fqcat <= 5) {
						var controlItem = document.getElementsByClassName("mui-control-item")[fqcat - 1];
						localStorage.setItem("nowFqcat", fqcat - 1);
					} else {
						var controlItem = document.getElementsByClassName("mui-control-item")[fqcat - 2];
						localStorage.setItem("nowFqcat", fqcat - 2);
					}
					if(controlItem) {
						plus.nativeUI.closeWaiting();
						//alert("我是跳转过来的----")
						controlItem.classList.add("mui-active");
						var wid = controlItem.getAttribute("data-wid");
						group.switchTab(wid);
						localStorage.removeItem("cloudstorecategoryOrder");
					}

					$(".mui-scroll").on("tap", ".mui-control-item", function(e) {
						//						alert("我是点击过来的---")
						var muiControlItem = document.getElementsByClassName("mui-control-item");
						for(var i = 0; i < muiControlItem.length; i++) {
							muiControlItem[i].classList.remove("mui-active");
						}
						this.classList.add("mui-active");
						//						localStorage.removeItem("nowFqcat");
						var wid = this.getAttribute("data-wid");
						var fqcat = this.getAttribute("data-fqcat");
						localStorage.setItem("nowFqcat", fqcat);
						group.switchTab(wid);
						localStorage.removeItem("cloudstorecategoryOrder");
						//将筛选菜单置空
						//						var wid = plus.webview.getWebviewById('wid'); //cont是父页面的ID
						mui.fire(wid, "clearDragLeftMenu");
						plus.nativeUI.closeWaiting();
						//fqcat

					});

				});
				//	$.back = function() {
				//		var _self = plus.webview.currentWebview();
				//		_self.close("auto");
				//	}
			})(mui, document)
		</script>
	</body>

</html>